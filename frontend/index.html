
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>chessboardjs.com &raquo; Homepage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600|Roboto+Mono">
    <link rel="stylesheet" href="css/website2.css" />
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css" integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU" crossorigin="anonymous">
</head>

<body class="homepage">

        <h2>Your ID: <span id="ws-id"></span></h2>
        <h2>Game ID: <span id="game-id">None</span></h2>
        <button onmousedown="sendMessage(event)">Join Game!</button>

<section class="homepage-section-88e4a body-width-115f6">

<div class="col-11bcf">
    <div id="board" style="width: 400px"></div>
    <button id="Champ_1">Champ 1</button>
    <button id="Champ_2">Champ 2</button>
    <ul id='messages'>
</div>
</section>

</main>
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/prettify.min.js"></script>
<script src="js/chessboard-1.0.0.min.js"></script>
<script src="js/chess_engine.js"></script>

<script>
    function isTouchDevice () {
    return ('ontouchstart' in document.documentElement)
  }
    var board = Chessboard('board', {
        draggable: true,
        dropOffBoard: 'trash',
        sparePieces: false,
        onDragStart: onDragStart,
        onDrop: onDrop,
        onSnapEnd: onSnapEnd
    })
  function init () {
    prettyPrint()

    $('#Champ_1').on('click', board.start)
    $('#Champ_2').on('click', board.clear)

    // prevent "browser drag" of the black king
    $('.hero-inner-556fe img').on('mousedown', function (evt) { evt.preventDefault() })

    // prevent hover problems on touch devices
    if (isTouchDevice()) {
      $('.navbar-a57cc').removeClass('hover-effect')
    }
  }

  $(document).ready(init)

    var client_id = Date.now().toString() + Math.floor((Math.random() * 1000000000000000)).toString()
    var champ_id = 0;
    // var color = null;
    var game_id = document.querySelector("#ws-id").textContent;

    var game = "{\"legal_moves\": [\"f3g5\", \"f3e5\", \"f3h4\", \"f3d4\", \"f3g1\", \"g2h3\", \"g2f1\", \"h1g1\", \"h1f1\", \"e1f1\", \"b1c3\", \"b1a3\", \"e1g1\", \"g3g4\", \"h2h3\", \"e2e3\", \"d2d3\", \"c2c3\", \"b2b3\", \"a2a3\", \"h2h4\", \"e2e4\", \"d2d4\", \"c2c4\", \"b2b4\", \"a2a4\"], \"termination\": null, \"winner\": null, \"turn\": \"w\"}"
    var color = ""
    game = JSON.parse(game)
    console.log(game)

    document.querySelector("#ws-id").textContent = client_id;

    var ws = new WebSocket(`ws://localhost:8000/ws/${client_id}`);

    ws.onmessage = function(event) {
        var messages = document.getElementById('messages')
        var message = document.createElement('li')
        var content = document.createTextNode(event.data)
        message.appendChild(content)
        messages.appendChild(message)

        const data = JSON.parse(event.data);
        game_id = data.game_id
        if (data.color)
            {color = data.color}
        // var color = (typeof color === 'undefined') ? data.color : color;
        // console.log(data)
        game = data
        // console.log(data.game_fen)
        document.querySelector("#game-id").textContent = game_id;
        board.position(data.game_fen)
        board.orientation(color)

    };
    function sendMessage(move) {

        const data = {
            client_id: client_id,
            champ_id: champ_id,
            timestamp: Date.now(),
            game_id: game_id,
            move: move
          };

        ws.send(JSON.stringify(data))
    }
</script>
</body>
</html>
